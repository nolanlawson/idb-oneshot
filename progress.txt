Phase 0: Project Scaffolding — COMPLETE
  - Created package.json (type: "module", better-sqlite3 + typescript deps)
  - Created tsconfig.json (strict, NodeNext, allowImportingTsExtensions)
  - Created CLAUDE.md with project conventions and commands
  - Created empty src/index.ts barrel export
  - Created .gitignore (node_modules, manifest, sqlite files)
  - Created test/wpt-harness-setup.ts (browser global shims for Node)
  - Created test/wpt-subprocess.ts (child process entry that loads testharness.js + test)
  - Created test/wpt-runner.ts (forks subprocess, parses JSON results, reports per-subtest)
  - Created test/run-all.ts (runs all .any.js files, generates manifest)
  - Verified: runner executes idbkeyrange.any.js, detects 10 subtests (all fail as expected - IDBKeyRange not yet implemented)
  - Verified: npx tsc --noEmit passes clean

Phase 1: IDBKeyRange + Key Validation + IDBFactory.cmp() — COMPLETE
  - Created src/types.ts (IDBKey, IDBValidKey type definitions)
  - Created src/errors.ts (DOMException helper factories for all IDB error types)
  - Created src/keys.ts (key validation via valueToKey/valueToKeyOrThrow, cross-type comparison via compareKeys, binary-comparable encoding via encodeKey)
  - Created src/IDBKeyRange.ts (only, lowerBound, upperBound, bound static methods + includes instance method)
  - Created src/IDBFactory.ts (cmp method; open/deleteDatabase/databases stubs for Phase 2)
  - Created src/DOMStringList.ts (length, item, contains, indexed access, Symbol.iterator)
  - Created stub classes: IDBRequest, IDBOpenDBRequest, IDBDatabase, IDBTransaction, IDBObjectStore, IDBIndex, IDBCursor, IDBCursorWithValue, IDBVersionChangeEvent
  - Updated src/index.ts barrel export with all classes
  - Updated test/wpt-harness-setup.ts to inject all IDB globals into test subprocess
  - WPT results (55/55 subtests passing):
    - idbkeyrange.any.js: 10/10 PASS
    - idbkeyrange-includes.any.js: 11/11 PASS
    - idbkeyrange_incorrect.any.js: 7/7 PASS
    - idbfactory_cmp.any.js: 12/12 PASS
    - historical.any.js: 15/15 PASS
  - key_valid.any.js, key_invalid.any.js, keyorder.any.js deferred to Phase 2 (require indexedDB.open)
  - npx tsc --noEmit passes clean

Phase 2: IDBFactory.open() + Database Lifecycle — COMPLETE
  - Created src/sqlite-backend.ts (SQLiteBackend class wrapping better-sqlite3: metadata DB, per-database files, CRUD for object stores/records/indexes, savepoint management)
  - Created src/scheduling.ts (queueTask via setTimeout(0) for async event dispatch)
  - Implemented src/IDBFactory.ts:
    - open(name, version): async open with version validation, upgrade transaction lifecycle, IDBVersionChangeEvent dispatch
    - deleteDatabase(name): async delete with versionchange notification to open connections, proper oldVersion tracking
    - databases(): returns list from metadata DB
    - Connection tracking for versionchange event dispatch (skips closed connections)
  - Implemented src/IDBDatabase.ts:
    - Connection properties: name, version, objectStoreNames (live from backend)
    - createObjectStore(): validates version change context, creates store in SQLite, updates transaction scope
    - deleteObjectStore(): validates context, deletes store and related records/indexes
    - transaction(): creates IDBTransaction with store name validation, auto-commit via microtask
    - close(): marks connection as closing to prevent new transactions
    - dispatchEvent override: wires on* handler properties to addEventListener pattern
  - Implemented src/IDBTransaction.ts:
    - Transaction lifecycle: active → inactive → committing → finished
    - objectStore(): SameObject-cached IDBObjectStore instances
    - abort(): rolls back SQLite savepoint, fires abort event, notifies DB for versionchange
    - commit()/auto-commit: releases savepoint, fires complete event
    - _createRequest(): creates IDBRequest with proper transaction binding
    - dispatchEvent override for on* handlers
    - Factory function pattern to break circular IDBObjectStore dependency
  - Implemented src/IDBObjectStore.ts:
    - CRUD operations: put(), add(), get(), getKey(), delete(), clear(), count()
    - Key path evaluation and injection for in-line keys
    - Auto-increment key generation
    - createIndex()/deleteIndex() for versionchange transactions
    - All operations fire events asynchronously via queueTask
  - Implemented src/IDBRequest.ts:
    - dispatchEvent override: temporarily registers on* handler as addEventListener listener for correct event.target
  - Updated src/IDBVersionChangeEvent.ts (unchanged, already working from Phase 1)
  - Updated src/types.ts: added global IDBTransactionMode type declaration
  - Updated src/index.ts: registers IDBObjectStore factory function to break circular dependency
  - Updated test/wpt-harness-setup.ts: added addEventListener/removeEventListener/dispatchEvent on globalThis for async test support
  - Updated test/wpt-subprocess.ts: added keepAliveInterval to prevent premature process exit during async tests
  - WPT results (90/92 subtests passing across Phase 1+2):
    Phase 1 (55/55 — unchanged):
    - idbkeyrange.any.js: 10/10 PASS
    - idbkeyrange-includes.any.js: 11/11 PASS
    - idbkeyrange_incorrect.any.js: 7/7 PASS
    - idbfactory_cmp.any.js: 12/12 PASS
    - historical.any.js: 15/15 PASS
    Phase 2 (35/37):
    - idbfactory_open.any.js: 28/29 PASS (1 fail requires cursor/index — Phase 4/5)
    - idbfactory-open-request-success.any.js: 1/1 PASS
    - idbfactory-open-request-error.any.js: 0/1 FAIL (requires unique index constraint — Phase 4)
    - idbfactory-open-error-properties.any.js: 1/1 PASS
    - idbfactory_deleteDatabase.any.js: 4/4 PASS
    - idbfactory-deleteDatabase-request-success.any.js: 1/1 PASS
    - idbversionchangeevent.any.js: 1/1 PASS
  - Deferred key tests now partially work with open():
    - key_valid.any.js: 14/18 (4 fail: Date/Infinity serialization — Phase 10 structured clone)
    - key_invalid.any.js: 33/34 (1 fail: Proxy array detection in put context)
    - keyorder.any.js: 12/24 (12 fail: require cursor — Phase 5)
  - npx tsc --noEmit passes clean

Phase 3: Object Store CRUD — COMPLETE
  - Implemented IDBKeyRange query support in get(), getKey(), delete(), count()
    - All methods now accept both exact keys and IDBKeyRange objects
    - Added queryToRange() helper for consistent key/range handling
    - Added getRecordInRange(), deleteRecordsInRange() to SQLiteBackend with _buildRangeQuery helper
    - count() now correctly filters by exact key or range
  - Implemented key path validation (isValidKeyPath/isValidKeyPathString)
    - createObjectStore now validates keyPath (SyntaxError for invalid paths)
    - createObjectStore rejects autoIncrement + empty string keyPath (InvalidAccessError)
    - createObjectStore rejects autoIncrement + array keyPath (InvalidAccessError)
    - createIndex validates keyPath
  - Fixed deleted object store detection
    - _ensureValid() now checks _deleted flag before every operation
    - deleteObjectStore() marks cached IDBObjectStore._deleted = true
    - All operations (add/put/get/getKey/delete/clear/count/createIndex/deleteIndex) throw InvalidStateError on deleted stores
  - Fixed getKey() argument validation
    - Throws TypeError when called with no arguments (per spec)
    - Returns decoded key from binary-encoded buffer for range queries
    - Added decodeKeyFromBuffer/decodeKeyAt for binary key decoding
  - Implemented unique index constraint enforcement
    - checkUniqueIndexConstraint() in SQLiteBackend checks for duplicate index keys
    - put/add check unique constraints before inserting and fire ConstraintError on violation
    - createIndex with unique:true aborts transaction if existing data violates constraint
  - Implemented index entry maintenance on put/add
    - deleteIndexEntriesForRecord() clears old entries before replacement
    - Adds new index entries for all indexes on the store after each put/add
    - Multi-entry index support: arrays are expanded into individual entries
    - _populateIndex() fills new index from existing records during createIndex
  - Improved index() stub to return proper NotFoundError for missing indexes
  - Fixed transaction auto-commit timing
    - Added _pendingRequestCount to IDBTransaction for accurate tracking
    - Separated _maybeAutoCommit() from _requestFinished() to avoid double-decrement
    - Nested requests during event handlers (e.g., count inside upgradeneeded) now work correctly
  - WPT results (93/102 subtests passing across Phase 3 target tests):
    - idbdatabase_createObjectStore.any.js: 26/27 PASS (1 fail: requires index() — Phase 4)
    - idbdatabase_deleteObjectStore.any.js: 3/3 PASS
    - idbobjectstore_add.any.js: 13/16 PASS (3 fail: require openCursor — Phase 5)
    - idbobjectstore_put.any.js: 13/16 PASS (3 fail: require openCursor — Phase 5)
    - idbobjectstore_get.any.js: 7/7 PASS
    - idbobjectstore_getKey.any.js: 17/17 PASS
    - idbobjectstore_delete.any.js: 7/7 PASS
    - idbobjectstore_clear.any.js: 2/4 PASS (2 fail: require openCursor/index — Phase 4/5)
    - idbobjectstore_count.any.js: 4/4 PASS
    - idbobjectstore_keyPath.any.js: 1/1 PASS
  - npx tsc --noEmit passes clean

Next: Phase 4 — Indexes
